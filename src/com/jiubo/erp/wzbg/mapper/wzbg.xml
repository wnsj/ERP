<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.jiubo.erp.wzgb.dao.ZpglDao">
	
	<!-- 添加请假报备 -->
	<insert id="addLeavePrepare" parameterType="LeavePrepareBean">
		INSERT INTO 
		Leave_Baobei(
			TYPE, TYPE, FILL_ACCOUNT, FILL_TIME, LEAVE_ACCOUNT, STARTTIME, ENDTIME,
			LEAVE_REMARK, CHECK_ACCOUNT, CHECK_TIME, CHECK_RESULT, UPDATE_TIME, ISSEE, STATE
		)VALUES(
			#{type}, #{fillAccount}, #{fillTime}, #{leaveAccount}, #{startTime}, #{endTime}, 
			#{leaveRemark}, #{checkAccount}, #{checkTime}, #{checkResult}, #{updateTime}, #{isSee} ,#{state}
		)
	</insert>
	
	<!-- 查询请假报备 -->
	<select id="queryLeavePrepare" resultType="LeavePrepareBean">
		SELECT 
			A.* , B.NAME 
		FROM (SELECT 
				LB.ID, LB.TYPE, LB.FILL_ACCOUNT, LB.FILL_TIME, LB.LEAVE_ACCOUNT,
				LB.STARTTIME, LB.ENDTIME, LB.LEAVE_REMARK, LB.CHECK_ACCOUNT, LB.CHECK_TIME,
				LB.CHECK_RESULT, LB.UPDATE_TIME, LB.ISSEE, LB.STATE, A.NAME 
			FROM
				(SELECT
					LB.FILL_ACCOUNT,
					DEPT.NAME 
				FROM
					Leave_Baobei AS LB
					LEFT JOIN T_Employee_Basic AS EMP ON LB.FILL_ACCOUNT = EMP.ACCOUNT
					LEFT JOIN T_Department AS DEPT ON EMP.DEPARTMENT_ID = DEPT.ID
				GROUP BY
					LB.FILL_ACCOUNT,DEPT.NAME 
				) AS A,
				Leave_Baobei AS LB 
			WHERE
				A.FILL_ACCOUNT = LB.FILL_ACCOUNT 
		) AS A,
			(SELECT
				LB.LEAVE_ACCOUNT,
				DEPT.NAME 
			FROM
				Leave_Baobei AS LB
				LEFT JOIN T_Employee_Basic AS EMP ON LB.LEAVE_ACCOUNT = EMP.ACCOUNT
				LEFT JOIN T_Department AS DEPT ON EMP.DEPARTMENT_ID = DEPT.ID
			GROUP BY LB.LEAVE_ACCOUNT, DEPT.NAME 
		) AS B 
		WHERE
			A.LEAVE_ACCOUNT = B.LEAVE_ACCOUNT
	</select>
	
	<!--  查询报备审批权限表 -->
	<select id="queryApprovalLeaveAccount" resultType="java.lang.String">
		SELECT APP.CHECK_POSITIONID FROM APPROVAL_BAOBEI
	</select>
	
	<!--  查询请假报备审批权限账户信息 -->
	<select id="queryApprovalLeaveAccount" resultType="com.jiubo.erp.erpLogin.AccountDataBean">
		SELECT 
			ACC.ACCOUNT_ID ACC.ACCOUNT_NAME
		FROM 
			Account_Data 
		WHERE 
			ACC.POSITION_ID IN #{args}
	</select>
</mapper>