<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.jiubo.erp.wzbg.dao.ComputerDao">
	<sql id="computerSql">
		C.ID id,
		C.DepartmentID deptId,
		DEPT.Name deptName,
		C.Job_ID positionId,
		PD.Position_Name positionName,
		C.Start_time submitTime,
		C.renshi_time useTime,
		C.prepare_time finishTime,
		C.Apply_ID applyId,
		C.Apply_name applyName,
		C.Apply_see applyIsSee,
		C.User_ID userId,
		C.User_name userName,
		C.User_see userIsSee,
		C.Zhu_ID leaderId,
		A1.Account_Name leaderName,
		C.Zhu_Advice leaderAudit,
		C.Zhu_see leadreIsSee,
		C.Prepare_ID handId,
		C.Prepare_name handName,
		C.Dui_see handIsSee,
		C.Fu_ID principalId,
		A2.Account_Name principalName,
		C.Fu_Advice principalAudit,
		C.Fu_see principalIsSee,
		C.Is_Reserve isReserve,
		C.Type_ID typeId,
		C.Articles_name typeName,
		C.Is_Ing status,
		C.Shuoming remark 
	</sql>
	<!-- 查询电脑预申请 -->
	<select id="queryPreApplication" resultType="ComputerBean">
		SELECT 
			<include refid="computerSql"></include>
		FROM 
			Computer C 
		LEFT JOIN T_Department DEPT
			ON DEPT.ID = C.DepartmentID
		LEFT JOIN Position_Data PD
			ON PD.Position_ID = C.Job_ID
		LEFT JOIN Account_Data A1
			ON A1.Account_ID = C.Zhu_ID
		LEFT JOIN Account_Data A2
			ON A2.Account_ID = C.Fu_ID
		WHERE
			C.Is_Reserve != 0
		<if test="accountId != null and accountId != '' ">
			AND (C.Apply_ID = #{accountId}
				OR C.User_ID = #{accountId}
				OR C.Zhu_ID = #{accountId}
				OR C.Fu_ID = #{accountId}
				<if test="accountName != null and accountName != '' ">
					OR C.User_name = #{accountName}
				</if>
			)
		</if>
		<if test="timeType != null and timeType != '' ">
			<choose>
				<when test="timeType == 0">
					<if test="beginTime != null and beginTime != '' ">
						AND C.Start_time <![CDATA[ >= ]]> #{beginTime}
					</if>
					<if test="endTime != null and endTime != '' ">
						AND C.Start_time <![CDATA[ <= ]]> #{endTime}
					</if>
				</when>
				<when test="timeType == 1">
					<if test="beginTime != null and beginTime != '' ">
						AND C.renshi_time <![CDATA[ >= ]]> #{beginTime}
					</if>
					<if test="endTime != null and endTime != '' ">
						AND C.renshi_time <![CDATA[ <= ]]> #{endTime}
					</if>
				</when>
				<when test="timeType == 2">
					<if test="beginTime != null and beginTime != '' ">
						AND C.End_time <![CDATA[ >= ]]> #{beginTime}
					</if>
					<if test="endTime != null and endTime != '' ">
						AND C.End_time <![CDATA[ <= ]]> #{endTime}
					</if>
				</when>
			</choose>
		</if>
		<if test="deptId != null and deptId != 0 and deptId != '' ">
			AND C.DepartmentID = #{deptId}
		</if>
		<if test="userName != null and userName != '' ">
			AND C.User_name LIKE '%' + #{userName} + '%'
		</if>
		<if test="handName != null and handName != '' ">
			AND C.Prepare_name LIKE '%' + #{handName} + '%'
		</if>
		ORDER BY C.ID
	</select>
	<!-- 添加电脑预申请 -->
	<insert id="addPreApplication" parameterType="ComputerBean">
		INSERT INTO Computer 
			(DepartmentID, Start_time, End_time, Apply_name, User_ID
			, User_name, Articles_name, Zhu_ID, Prepare_ID, Job_ID
			, Zhu_Advice, Fu_Advice, Type_ID, Apply_see, Zhu_see
			, Fu_see, Dui_see, User_see, Apply_ID, Fu_ID
			, Is_Reserve, renshi_time, prepare_time, Prepare_name, Shuoming
			, Pei_Jiedan_ID, Pei_Jiedan_ID_see, Is_Pei, Is_Ing)
		VALUES 
			(#{deptId}, #{submitTime}, #{}, #{applyName}, #{userId},
			#{userName}, #{typeName}, #{leaderId}, #{handId}, #{positionId},
			#{leaderAudit}, #{principalAudit}, #{typeId}, #{applyIsSee}, #{leadreIsSee}, 
			#{principalIsSee}, #{handIsSee}, #{userIsSee}, #{applyId}, #{principalId},
			#{isReserve}, #{useTime}, #{finishTime}, #{handName}, #{remark},
			#{configId}, #{configName}, #{isConfig}, #{status}
			)
	</insert>
	<!-- 查询岗位信息 -->
	<select id="queryPositionInfo" resultType="PositionInfo">
		SELECT  
			P.Position_ID positionId,
			P.Position_Name positionName
		FROM 
		Position_Data P
	</select>
</mapper>